"use strict";

var _path = require("path");

var _yargsParser = _interopRequireDefault(require("yargs-parser"));

var _signale = _interopRequireDefault(require("signale"));

var _buildDevOpts = _interopRequireDefault(require("./buildDevOpts"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let script = process.argv[2];
const args = (0, _yargsParser.default)(process.argv.slice(3)); // Node version check

const nodeVersion = process.versions.node;
const versions = nodeVersion.split('.');
const major = versions[0];
const minor = versions[1];

if (major * 10 + minor * 1 < 65) {
  _signale.default.error(`Node version must >= 6.5, but got ${major}.${minor}`);

  process.exit(1);
} // Notify update when process exits


const updater = require('update-notifier');

const pkg = require('../package.json');

updater({
  pkg
}).notify({
  defer: true
});
process.env.UMI_DIR = (0, _path.dirname)(require.resolve('../package'));
process.env.UMI_VERSION = pkg.version;

switch (script) {
  case 'build':
  case 'dev':
  case 'test':
    require(`./scripts/${script}`);

    break;

  case '-v':
  case '--version':
    script = 'version';

  case '-h':
  case '--help':
    script = 'help';

  default:
    {
      const Service = require('umi-build-dev/lib/Service').default;

      new Service((0, _buildDevOpts.default)(args)).run(script, args);
      break;
    }
}